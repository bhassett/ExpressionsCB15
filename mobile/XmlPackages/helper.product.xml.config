<?xml version="1.0" encoding="utf-8"?>
<package displayname="Product Helper" version="2.1" debug="false">

  <!-- ###################################################################################################### -->
  <!-- Licensed by Interprise Solutions.					                          -->
  <!-- http://www.InterpriseSolutions.com														                                          -->
  <!-- For details on this license please visit  the product homepage at the URL above.		                    -->
  <!-- THE ABOVE NOTICE MUST REMAIN INTACT.                                                                   -->
  <!-- ###################################################################################################### -->
 
  <PackageTransform>
    <xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:ise="urn:ise" exclude-result-prefixes="ise">
      <xsl:output method="html" omit-xml-declaration="yes" encoding="utf-8" />
      <xsl:param name="SectionType" select="FIELD/SECTION_TYPE" />
      
      <xsl:variable name="ProductID" select="FIELD/ProductID"/>
      <xsl:variable name="ProductName" select="FIELD/ProductName"/>
      <xsl:variable name="ProductUrl" select="FIELD/ProductUrl"/>
      <xsl:variable name="ProductDesc" select="FIELD/ProductDesc"/>
      <xsl:variable name="CategoryID" select="FIELD/CategoryID"/>
      
      <xsl:template match="/">
        <xsl:variable name="item_counter" select="FIELD/ITEM_COUNTER" />
        <xsl:variable name="skin_id" select="FIELD/SKIN_ID" />
        <xsl:variable name="item_type" select="FIELD/ITEM_TYPE" />
        <xsl:choose>

          <xsl:when test="$SectionType='DISPLAY_ADDTOCARTFORM'">

            <!--continue if show buy button is true / not whole sale and customer default price not whole sale -->
            <xsl:if test="FIELD/SHOW_BUY_BUTTON = 'true' and (FIELD/IS_WHOLESALE_ONSITE = 'false' or FIELD/IS_CUSTOMER_DEFAULT_PRICE_NOT_WHOLESALE = 'false') and FIELD/IS_SHOW_ITEM_PRICE_WHEN_LOGIN = 'false' " >

              <!--show if call to order has value-->
              <xsl:if test="FIELD/CALL_TO_ORDER_TEXT">
                <form>
                  <font class="CallToOrder">
                    <xsl:value-of select="FIELD/CALL_TO_ORDER_TEXT" />
                  </font>
                </form>
              </xsl:if>

              <!--if item type is electronic download-->
              <xsl:if test="$item_type = 'Electronic Download'">

                <!--if the downloadable item is not available-->
                <xsl:if test="FIELD/NO_AVAILABLE_DOWNLOAD_TEXT">
                  <span>
                    <xsl:value-of select="FIELD/NO_AVAILABLE_DOWNLOAD_TEXT" />
                  </span>
                </xsl:if>

                <!--if customer is not registered-->
                <xsl:if test="FIELD/CUSTOMER_NOT_REGISTERED_TEXT">
                  <span>
                    <xsl:value-of select="FIELD/CUSTOMER_NOT_REGISTERED_TEXT" />
                  </span>
                </xsl:if>

              </xsl:if>

              <div class="displayproduct_pnlAddToCartForm" >
                <xsl:attribute name="id">
                  <xsl:text>pnlAddToCartForm_</xsl:text><xsl:value-of select="$item_counter" />
                </xsl:attribute>
                
                <form method="POST" id="{concat('AddToCartForm_', $item_counter)}" name="{concat('AddToCartForm_', $item_counter)}" action="{FIELD/FORM_ACTION}" >
                  <input type="hidden" name="ProductID" id="{concat('ProductID_', $item_counter)}" value="{$item_counter}" />
                  <input type="hidden" name="IsWishList" value="0" id="{concat('IsWishList', '_', $item_counter)}" />
                  <input type="hidden" id="UpsellProducts" name="UpsellProducts" value="" />

                  <xsl:if test="$item_type = 'Kit'">
                    <!--if has pricing type -->
                    <xsl:if test="FIELD/KIT_PRICING_TYPE">
                      <input type="hidden" name="KitPricingType" id="KitPricingType" value="{FIELD/KIT_PRICING_TYPE}" />
                    </xsl:if>
                    <input type="hidden" name="KitItems" id="KitItems" class="KitItems" value="" />
                    <!--if this kit item has query string-->
                    <xsl:if test="FIELD/ITEM_KIT_IS_EDITMODE">
                      <input name="IsEditKit" type="hidden" value="true" />
                      <input name="KitCartID" type="hidden" value="{FIELD/KIT_CART_ID}" />
                    </xsl:if>
                  </xsl:if>

                  <span id="{concat('ctrlQuantity_', $item_counter)}">
                  </span>
                  
                  <xsl:if test="FIELD/SHOW_MEASURE = 'true'">
                    <span class="showproduct_unitmeasure" id="{concat('ctrlUnitMeasure_', $item_counter)}">
                    </span>
                  </xsl:if>

                  <div class="showproduct_button_layout" >
                    <!--Add to cart button-->
                    <a class="button addSpace" id="{concat('AddToCart_', $item_counter)}" name="{concat('AddToCart_', $item_counter)}">
                      <span class="slide">
                        <!-- check caption if edit or add -->
                        <xsl:choose>
                          <xsl:when test="FIELD/ITEM_KIT_IS_EDITMODE and FIELD/ITEM_KIT_IS_EDITMODE = 'true'" >
                            <xsl:value-of select="FIELD/EDITCART_BUTTON_CAPTION" />
                          </xsl:when>
                          <xsl:otherwise>
                            <xsl:value-of select="FIELD/ADDTOCART_BUTTON_CAPTION" />
                          </xsl:otherwise>
                        </xsl:choose>
                      </span>
                    </a>
                    <!--wishlist button-->
                    <!--test if show wishlist button-->
                    <xsl:if test="FIELD/SHOWWISHLISTBUTTON = 'true'">
                      <a class="button" id="{concat('AddToWishList_',$item_counter)}" name="{concat('AddToWishList_',$item_counter)}" >
                        <span class="slide">
                          <xsl:value-of select="FIELD/WISHLIST_CAPTION" />
                        </span>
                      </a>
                    </xsl:if>
                  </div>
                </form>
              </div>

              <script type="text/javascript" >
                $(document).ready(function(){
                  InitAddToCartFormScript('<xsl:value-of select="FIELD/CART_JSON_SCRIPT" />');
                });
              </script>

            </xsl:if>

          </xsl:when>

          <xsl:when test="$SectionType='DISPLAY_PRODUCTIMAGE'">
            <div id="{concat('pnlImage_', $item_counter)}">
              <img class="mobileimagesize" id="{concat('imgProduct_', $item_counter)}" alt="{/FIELD/IMAGE/ALT_TEXT}" title="{/FIELD/IMAGE/TITLE_TEXT}" />
              <br />
              <br />
              <div class="matrix_counter" id="{concat('pnlImageMultiples_',$item_counter)}">
                <xsl:for-each select="/FIELD/ITERATOR/CTR">
                  <xsl:variable name="ctr" select=". + 1" />
                  <img style="display:none;cursor:hand;cursor:pointer;" id="{concat('imgMultiple_', $item_counter, concat('_',current()))}" alt="{$ctr}" title="{$ctr}" />
                </xsl:for-each>
              </div>
              <div id="{concat('pnlLargeImage_', $item_counter)}">
                <a href="javascript:void(0);" style="display:none;" id="{concat('lnkLarge_',$item_counter)}">
                  <img align="middle" src="{concat('skins/skin_',$skin_id,'/images/showlarger.gif')}" alt="{/FIELD/LARGE_IMAGE/ALT_TEXT}" title="{/FIELD/LARGE_IMAGE/TITLE_TEXT}" />
                </a>
              </div>
              <!--Matrix item swatch-->
              <xsl:if test="FIELD/ITEM_TYPE = 'Matrix Group' and count(FIELD/JSON_SWATCHITEM) >0">
                <br />
                <div class="swatch_main" id="{concat('pnlImageSwatch_',$item_counter)}">
                  <xsl:for-each select="FIELD/JSON_SWATCHITEM" >
                    <xsl:apply-templates select="current()" />
                  </xsl:for-each>
                </div>
              </xsl:if>
              <script type="text/javascript" >
                $(document).ready(function(){
                  InitImageControl(<xsl:value-of select="$item_counter" />,<xsl:value-of select="$skin_id"/>, <xsl:value-of select="FIELD/USEIMAGESFORMULTINAV"/>, <xsl:value-of select="FIELD/USEROLLOVERFORMULTINAV"/>, '<xsl:value-of select="FIELD/ITEM_TYPE"/>', '<xsl:value-of select="FIELD/JSON_MATRIX_ITEMS"/>');
                });
              </script>
              
            </div>
          </xsl:when>
          
          <xsl:when test="$SectionType='PRICEDROP_NOTIFICATION_CONTROL'">
            <div id="pnlNotifyPriceDrop_{$item_counter}"></div>

            <script type="text/javascript">
              $add_windowLoad(function() {
                var counter = <xsl:value-of select="$item_counter"></xsl:value-of>;
                var hasSubscription = <xsl:value-of select="FIELD/SUBSCRIBED"></xsl:value-of>;
                
                ise.StringResource.registerString('AppConfig.NotifyOnPriceDropButtonPrompt', '<xsl:value-of select="FIELD/BUTTON_PROMPT"></xsl:value-of>');
                ise.StringResource.registerString('AppConfig.NotifyOnPriceDropMessagePrompt', '<xsl:value-of select="FIELD/MESSAGE_PROMPT"></xsl:value-of>');
                
                var product = ise.Products.ProductController.getProduct(counter);
                var notifyPriceDropControl = new ise.Products.NotifyPriceDropControl(counter, 'pnlNotifyPriceDrop_' + counter, hasSubscription);
            
                if (product.getItemType() != "Matrix Group")
                {
                  notifyPriceDropControl.setProduct(product);
                }
                else
                {
                  var matrixProductGroup = ise.Products.ProductController.getProduct(counter);
                  
                  if(matrixProductGroup != null) {
                  
                    if(typeof matrixProductGroup.onMatrixItemAssignmentSuccessfulForPriceDrop != 'undefined') {
                    
                      matrixProductGroup.onMatrixItemAssignmentSuccessfulForPriceDrop = function(found) {
                        
                        if (found)
                        {
                          notifyPriceDropControl.setProduct(product);
                          $('#pnlNotifyPriceDrop_' + counter).show();
                        }
                        else
                        {
                          $('#pnlNotifyPriceDrop_' + counter).hide();
                        }
                        
                      };
                    }
                    
                  }
                }
            });
            </script>
          </xsl:when>

          <xsl:when test="$SectionType='DISPLAY_ACCESSORIES'">
            <div class="signin_info">
              <div class="tableHeaderArea">
                <xsl:value-of select="FIELD/ACCESSORIES_HEADER_TEXT"/>
              </div>
              <div class="signin_info_body">
                
                <xsl:if test="string-length(FIELD/UPSALE_TEXT)>0">
                  <br />
                  <div class="product_teaser kit_details">
                    <xsl:value-of select="FIELD/UPSALE_TEXT"/>
                  </div>
                </xsl:if>
                
                <xsl:variable name="include_script" select="FIELD/INCLUDE_SCRIPT" />
                
                <xsl:variable name="is_valid_accessories" select="FIELD/IS_VALID_ACCESSORY" />
                
                <form id="UpsellForm" name="UpsellForm" >
                  <input style="visibility: hidden;" type="checkbox" id="Upsell" name="Upsell" value="0" onclick="UpsellClick(this);" />
                  <xsl:for-each select="FIELD/SUBSTITUTE_ITEMS">
                    <div class="item_container">
                      <!-- section that calls the 'IMAGE' template below -->
                      <xsl:apply-templates select="current()"/>
                      <div class="substitute_showproduct_detail">
                        <a href="{ITEM_LINK}">
                          <span class="product_description">
                            <xsl:value-of select="ITEM_NAME" />
                          </span>
                        </a>
                        <br />
                        <br />
                        <xsl:if test="(IS_WHOLESALE_ONLYSITE = 'false' and IS_SHOW_ITEM_PRICE_WHEN_LOGIN = 'false') or VAT_ENABLED = 'true'">
                          <span class="addSpace">
                            <b>
                              <xsl:value-of select="VAT_TEXT" />
                            </b>
                          </span>
                          <span class="showproduct_Price">
                            <xsl:value-of select="ITEM_PRICE" />
                          </span>
                          <br />
                          <br />
                        </xsl:if>
                        <input type="checkbox" id="Upsell" name="Upsell" value="{ITEM_COUNTER}"> 
                          <xsl:if test="$include_script = 'true'">
                            <xsl:attribute name="onclick">
                              <xsl:text>UpsellClick(this)</xsl:text>
                            </xsl:attribute>
                          </xsl:if>
                          <xsl:if test="is_valid_accessories = 'false'">
                            <xsl:attribute name="disabled">
                              <xsl:text>disabled</xsl:text>
                            </xsl:attribute>
                          </xsl:if>
                        </input >
                        <br />
                        <xsl:if test="EXTENDED_DESCRIPTION and EXTENDED_DESCRIPTION != ''">
                          <br />
                          <a href="javascript:void(0)">
                            <xsl:attribute name="onclick">
                              <xsl:text>jqueryHideShow('#accessories_extended_details_</xsl:text>
                              <xsl:value-of select="ITEM_COUNTER" />
                              <xsl:text>');</xsl:text>
                            </xsl:attribute>
                            <span class="kitdetaillink">
                              <xsl:value-of select="SHOW_EXTENDED_TEXT" disable-output-escaping="yes" />
                            </span>
                          </a>
                          <br />
                          <div style="display:none" class="extendedInfo kit_details" id="{concat('accessories_extended_details_', ITEM_COUNTER)}">
                            <span>
                              <xsl:value-of select="EXTENDED_DESCRIPTION" disable-output-escaping="yes" />
                            </span>
                          </div>
                        </xsl:if>
                      </div>
                    </div>
                  </xsl:for-each>
                </form>
              </div>
            </div>
          </xsl:when>

          <xsl:when test="$SectionType='DISPLAY_SUBSTITUTEPRODUCT'">
            <div class="signin_info">
              <div class="tableHeaderArea">
                <xsl:value-of select="FIELD/SUBSTITUTE_HEADER_TEXT"/>
              </div>
              <div class="clear"></div>
              <div class="signin_info_body">
                <xsl:choose >
                  <xsl:when test="FIELD/SUBSTITUE_TABLE_FORMAT = 'GRID'" >
                    <xsl:for-each select="FIELD/SUBSTITUTE_ITEMS">
                      <div class="product_detail_wrapper">

                        <!-- section that calls the 'IMAGE' template below-->
                        <xsl:apply-templates select="current()" />
                        <div class="substitute_showproduct_detail">
                          <a href="{ITEM_LINK}">
                            <span class="product_description">
                              <xsl:value-of select="ITEM_NAME"/>
                            </span>
                          </a>
                        </div>
                      </div>
                    </xsl:for-each>
                  </xsl:when>
                  <xsl:otherwise>
                    <xsl:for-each select="FIELD/SUBSTITUTE_ITEMS">
                      <xsl:variable name="substitute_item_counter" select="COUNTER" />
                      <div class="product_detail_wrapper">
                        <!-- section that calls the 'IMAGE' template below -->
                        <xsl:apply-templates select="current()" />
                        <div class="substitute_showproduct_detail">
                          <a>
                            <xsl:attribute name="href">
                              <xsl:value-of select="ITEM_LINK"/>
                            </xsl:attribute>
                            <span class="product_description">
                              <xsl:value-of select="ITEM_NAME"/>
                            </span>
                          </a>
                          <br />
                          <br />
                          <xsl:variable name="extended_details_id">
                            <xsl:text>extended_details_</xsl:text>
                            <xsl:value-of select="$substitute_item_counter" />
                          </xsl:variable>
                          <a href="javascript:void(0)">
                            <xsl:attribute name="onclick">
                              <xsl:text>jqueryHideShow('#</xsl:text>
                              <xsl:value-of select="$extended_details_id"/>
                              <xsl:text>');</xsl:text>
                            </xsl:attribute>
                            <span class="kitdetaillink">
                              <xsl:value-of select="SHOW_EXTENDED_TEXT" disable-output-escaping="yes" />
                            </span>
                          </a>
                          <br/>
                          <div style="display:none" class="extendedInfo kit_details">
                            <xsl:attribute name="id">
                              <xsl:value-of select="$extended_details_id" />
                            </xsl:attribute>
                            <span>
                              <xsl:if test="WEB_DESCRIPTION">
                                <xsl:value-of select="WEB_DESCRIPTION" disable-output-escaping="yes" />
                              </xsl:if>
                              <xsl:if test="EXTENDED_DESCRIPTION">
                                <xsl:value-of select="EXTENDED_DESCRIPTION" disable-output-escaping="yes" />
                              </xsl:if>
                            </span>
                          </div>
                        </div>
                      </div>
                    </xsl:for-each>
                  </xsl:otherwise>
                </xsl:choose>
              </div>
            </div>
          </xsl:when>
          
          <xsl:when test="$SectionType='AVAILABILITY_NOTIFICATION_CONTROL'">
            <div id="pnlNotifyOnItemAvail_{$item_counter}"></div>

            <script type="text/javascript">
              $add_windowLoad(function() {
              var counter = <xsl:value-of select="$item_counter"></xsl:value-of>;
                var hasSubscription = <xsl:value-of select="FIELD/SUBSCRIBED"></xsl:value-of>;
                
                ise.StringResource.registerString('AppConfig.NotifyOnItemAvailButtonPrompt', '<xsl:value-of select="FIELD/BUTTON_PROMPT"></xsl:value-of>');
                ise.StringResource.registerString('AppConfig.NotifyOnItemAvailMessagePrompt', '<xsl:value-of select="FIELD/MESSAGE_PROMPT"></xsl:value-of>');
                
                var product = ise.Products.ProductController.getProduct(counter);
                var notifyOnItemAvailControl = new ise.Products.NotifyOnItemAvailControl(counter, 'pnlNotifyOnItemAvail_' + counter, hasSubscription);
                
                if (product.getItemType() != "Matrix Group")
                {
                  notifyOnItemAvailControl.setProduct(product);
                }
                else
                {
                  var matrixProductGroup = ise.Products.ProductController.getProduct(counter);
                  
                  if(matrixProductGroup != null) {
                  
                    if(typeof matrixProductGroup.onMatrixItemAssignmentSuccessfulForItemAvailability != 'undefined') {
                    
                      matrixProductGroup.onMatrixItemAssignmentSuccessfulForItemAvailability = function(found) {
                        if (found)
                        {
                          notifyOnItemAvailControl.setProduct(product);
                          $('#pnlNotifyOnItemAvail_' + counter).show();
                        }
                        else
                        {
                          $('#pnlNotifyOnItemAvail_' + counter).hide();
                        }
                      };
                      
                    }  
                    
                  }
                }
            });
            </script>
          </xsl:when>

          <xsl:when test="$SectionType='DISPLAY_PRICE'">
            <xsl:choose>
              <xsl:when test="FIELD/IS_KIT and FIELD/IS_KIT = true">
                <div id="{concat('PopUpKitPrice_', $item_counter)}">
                  <div>
                    <span id="{concat('PopUpKitPrice_', $item_counter,'_Price')}">
                    </span>
                  </div>
                </div>
                <xsl:value-of select="FIELD/KITPRICE_SCRIPT" disable-output-escaping="yes"/>
              </xsl:when>
              <xsl:otherwise>
                <div id="{concat('pnlDisplayPrice_', $item_counter)}">
                </div>
                <xsl:value-of select="FIELD/PRICE_SCRIPT" disable-output-escaping="yes" />
              </xsl:otherwise>
            </xsl:choose>
          </xsl:when>

          <xsl:when test="$SectionType='DISPLAY_PRICINGLEVEL'">
            <div id="{concat('pnlPricingLevel_',$item_counter)}" name="{concat('pnlPricingLevel_',$item_counter)}">
              <div style="display:none" id="{concat('pnlPricingLevelPopUp_',$item_counter)}" name="{concat('pnlPricingLevelPopUp_',$item_counter)}">
                <p>
                  <small>
                    <xsl:value-of select="FIELD/QUALIFY_TEXT"/>
                    <a href="javascript:void(0)" class="kitdetaillink lnkhideshow" id="{concat('lnkPricingLevelPopUp_',item_counter)}">
                      <span>
                        <xsl:value-of select="FIELD/WHATS_THIS_TEXT"/>
                      </span>
                    </a>
                  </small>
                </p>
              </div>
              <div style="display:none" class="pricingLevelInlineDetails kit_details" id="{concat('pnlPricingLevelInline_',$item_counter)}" name="{concat('pnlPricingLevelInline_',$item_counter)}" >
              </div>
              <br />
            </div>
            <xsl:value-of select="FIELD/PRICINGLEVEL_SCRIPT" disable-output-escaping="yes" />
          </xsl:when>

          <xsl:when test="$SectionType='DISPLAY_STOCKHINT'">
            <div id="{concat('pnlStockHint_', $item_counter)}" name="{concat('pnlStockHint_', $item_counter)}">
              <xsl:choose>
                <xsl:when test="FIELD/SHOW_STOCK_HINTS = 'true'">
                  <img id="{concat('imgStockHint_',$item_counter)}" />
                  <span id="{concat('lblStockHint_',$item_counter)}" style="visibility:hidden" />
                </xsl:when>
                <xsl:when test="FIELD/SHOW_ACTUAL_INVENTORY = 'true'">
                  <span id="{concat('lblStockHint_',$item_counter)}" />
                  <img id="{concat('imgStockHint_', $item_counter)}" style="visibility:hidden" />
                </xsl:when>
                <xsl:otherwise>
                </xsl:otherwise>
              </xsl:choose>
            </div>
            <xsl:value-of select="FIELD/STOCKHINTS_SCRIPT" disable-output-escaping="yes"/>
          </xsl:when>
          
          <!--Obsolete Code-->

          <!--<xsl:when test="$SectionType='DISPLAY_EMAILPRODUCTTOFRIEND'">
            <br/>
            <small>
              <img border="0" align="absmiddle" src="{FIELD/EMAILICON_URL}" />
              <a href="{concat('emailproduct.aspx?productId=', FIELD/PRODUCT_ID, '&amp;categoryid=', FIELD/CATEGORY_ID)}" class="kitdetaillink">
                <xsl:value-of select="FIELD/LINK_TEXT" />
              </a>
            </small>
            <br/>
          </xsl:when>-->

          <xsl:when test="$SectionType='DISPLAY_EXPECTEDSHIPDATE'">
            <div class="errorLg" id="{concat('pnlDisplayExpShipDate_', $item_counter)}">
              <xsl:value-of select="FIELD/EXPECTED_DATE_TEXT" disable-output-escaping="yes" />
              <span style="padding-left:5px">
                <xsl:value-of select="FIELD/EXPECTED_DATE" disable-output-escaping="yes"/>
              </span>
            </div>
          </xsl:when>

          <xsl:when test="$SectionType='REGISTER_STOCK_PRODUCT_JSCRIPT'">
            <script type="text/javascript">
              $(document).ready(function(){
                var param = <xsl:value-of select="FIELD/REGISTER_PRODUCT_JSON_PARAM" />;
                InitProductRegistration(param);
              });
            </script>
          </xsl:when>

          <xsl:when test="$SectionType='DISPLAY_MATRIX_ATTRIBUTES'">
            <div class="errorLg" id="{concat('pnlMatrixAttribute_Error_',$item_counter)}" >
            </div>
            <div style="display: none;" id="{concat('pnlMatrixAttribute_SelectCaption_', $item_counter)}">
            </div>
            <br />
            <xsl:for-each select="FIELD/HEADER_ATTRIBUTE" >
              <xsl:variable name="selectId">
                <xsl:text>MatrixAttribute_</xsl:text><xsl:value-of select="current()/ITEM_COUNTER" />_<xsl:value-of select="current()/HEADER_CTR" />
              </xsl:variable>
              <select id="{$selectId}" name="{$selectId}">
                <option value="{current()/HEADER_ATTRIBUTE_CODE}">
                  <xsl:value-of select="current()/HEADER_CUSTOM_TEXT" />
                  <xsl:text disable-output-escaping="yes">&amp;nbsp;</xsl:text>
                  <xsl:value-of select="current()/HEADER_ATTRIBUTE_DESCRIPTION" disable-output-escaping="yes" />
                </option>

                <xsl:for-each select="current()/ATTRIBUTE_ITEM" >
                  <option value="{current()/ITEM_ATTRIBUTE_CODE}">
                    <xsl:value-of select="current()/ITEM_ATTRIBUTE_DESCRIPTION" disable-output-escaping="yes" />
                  </option>
                </xsl:for-each>

              </select>
              <br />
              <br />
            </xsl:for-each>

            <script type="text/javascript">

              $(document).ready(function(){
                <xsl:value-of select="FIELD/ATTRIBUTE_SCRIPT" />
              });

              $(window).load(function(){
                var itemcounter =  <xsl:value-of select="$item_counter" />;
                var selectedmatrix =  '<xsl:value-of select="FIELD/SELECTED_MATRIX_ITEMCODE" />';

                if(selectedmatrix != ''){
                  var product = ise.Products.ProductController.getProduct(itemcounter);
                  product.chooseMatrixItem(selectedmatrix);
                }
              });
            </script>

          </xsl:when>

          <xsl:when test="$SectionType='DISPLAY_NAV_LINKS'">
            <xsl:if test="FIELD/HIDEPRODUCTNEXTPREVLINKS = 'false'">
              <table class="navLinkscontainer">
                <tr>
                  <xsl:if test="FIELD/PREV_HREF" >
                    <td class="prev_href" >
                      <a class="ProductNavLink" href="{FIELD/PREV_HREF}">
                        <xsl:choose >
                          <xsl:when test="FIELD/USE_GRAPHICS = 'true'">
                            <img alt="" title="" src="{concat('skins/Skin_', FIELD/SKIN_ID, '/images/previous.png')}" />
                          </xsl:when>
                          <xsl:otherwise>
                            <span>
                              <xsl:value-of select="FIELD/PREV_NO_IMAGE_TEXT" />
                            </span>
                          </xsl:otherwise>
                        </xsl:choose>
                      </a>
                    </td>
                  </xsl:if>
                  <xsl:if test="FIELD/INCLUDEUPLINK = 'true' and string-length(FIELD/ENTITY_SENAME) > 0" >
                    <td class="up_href">
                      <a class="ProductNavLink" href="{FIELD/UP_HREF}">
                        <xsl:choose >
                          <xsl:when test="FIELD/USE_GRAPHICS = 'true'">
                            <img alt="" title="" src="{concat('skins/Skin_', FIELD/SKIN_ID, '/images/up.png')}" />
                          </xsl:when>
                          <xsl:otherwise>
                            <span>
                              <xsl:value-of select="FIELD/UP_NO_IMAGE_TEXT" />
                            </span>
                          </xsl:otherwise>
                        </xsl:choose>
                      </a>
                    </td>
                  </xsl:if>
                  <xsl:if test="FIELD/NEXT_HREF" >
                    <td class="next_href">
                      <a class="ProductNavLink" href="{FIELD/NEXT_HREF}">
                        <xsl:choose >
                          <xsl:when test="FIELD/USE_GRAPHICS = 'true'">
                            <img alt="" title="" src="{concat('skins/Skin_', FIELD/SKIN_ID, '/images/next.png')}" />
                          </xsl:when>
                          <xsl:otherwise>
                            <span>
                              <xsl:value-of select="FIELD/NEXT_NO_IMAGE_TEXT" />
                            </span>
                          </xsl:otherwise>
                        </xsl:choose>
                      </a>
                    </td>
                  </xsl:if>
                </tr>
              </table>
            </xsl:if>
          </xsl:when>

          <xsl:when test="$SectionType='DISPLAY_KIT_DETAILS'">
            <!--Kit total price display-->
            <div class="signin_info">
              <div class="tableHeaderArea" id="KitAddToCartFormHeader">
                <xsl:value-of select="FIELD/ADDTOCART_HEADER_TEXT" />
                <a href="javascript:void(0);" class="kitdetaillink2" style="float:right" id="lnkKitTotalContainer">
                  <xsl:attribute name="onclick">
                    <xsl:text>jqueryHideShow('#KitTotalContainer','#lnkKitTotalContainer','( + )','( - )');</xsl:text>
                  </xsl:attribute>
                  <span>( - )</span>
                </a>
              </div>
              
              <div class="signin_info_body" id="KitTotalContainer" >
                <div id="KitPlaceHolder" ></div>
                <div id="KitSideBar" ></div>
                <div class="kit_pricing_main" id="{concat('pnlKitDetailsMain_',$item_counter)}">
                  <xsl:if test="FIELD/DISPLAY_PRICE">
                    <div class="KitAddToCartFormPricePopUp" id="{concat('PopUpKitPrice_', $item_counter)}" >
                      <span class="showproduct_Price" id="{concat('PopUpKitPrice_', $item_counter,'_Price')}">
                      </span>
                    </div>
                  </xsl:if>
                  <br />
                  <div class="KitAddToCartFormDetailsHeader" id="{concat('pnlKitDetailsHeader_', $item_counter)}">
                  <!--<a href="javascript:void(0);" class="kitdetaillink" >
                    <xsl:attribute name="id">
                      <xsl:text>lnkKitDetailHeader_</xsl:text>
                      <xsl:value-of select="$item_counter" />
                    </xsl:attribute>
                    <span>- Kit Details -</span>
                  </a>-->
                  </div>
                    <div class="extendedInfo kit_details" id="{concat('pnlKitDetails_', $item_counter)}" >
                    </div>
                  <br />
                  <xsl:value-of select="FIELD/ADDTOCART_FORM" disable-output-escaping="yes" />
                </div>
              </div>
            </div>

            <xsl:choose >
              <xsl:when test="count(FIELD/KIT_GROUP_ITEM) > 0" >
                
                <xsl:for-each select="FIELD/KIT_GROUP_ITEM">
              
                  <xsl:variable name="group_id" select="current()/GROUP_ID"></xsl:variable>
                  <xsl:variable name="group_type" select="current()/GROUP_TYPE" ></xsl:variable>

                  <xsl:variable name="kitLinkId">
                    <xsl:text>lnkKitItem_</xsl:text>
                    <xsl:value-of select="$group_id" />
                  </xsl:variable>

                  <xsl:variable name="kitItemdivId">
                    <xsl:text>divKitItem_</xsl:text>
                    <xsl:value-of select="$group_id" />
                  </xsl:variable>

                  <div class="signin_info">
                    <div class="tableHeaderArea" id="{concat('KitGroup_', $group_id)}">
                      <span id="{concat('lblKitGroup_',$group_id)}">
                        <xsl:if test="$group_type = 'Required'">
                          <xsl:text>*</xsl:text>
                        </xsl:if>
                        <xsl:value-of select="current()/GROUP_TEXT" />
                      </span>
                      <a href="javascript:void(0);" class="kitdetaillink2" style="float:right" id="{$kitLinkId}">
                        <xsl:attribute name="onclick">
                          <xsl:text>jqueryHideShow('#</xsl:text><xsl:value-of select="$kitItemdivId"/><xsl:text>','#</xsl:text><xsl:value-of select="$kitLinkId" /><xsl:text>','( + )','( - )');</xsl:text>
                        </xsl:attribute>
                        <span>( + )</span>
                      </a>
                    </div>
                    <div class="clear"></div>
                    <div class="product_detail_wrapper" style="display:none" id="{$kitItemdivId}" >
                      <xsl:choose>
                        <!--Required-->
                        <xsl:when test="$group_type = 'Required'">
                          <xsl:choose>
                            <xsl:when test="current()/CONTROL_TYPE = 'Single select drop down'">
                              <div class="kit_item_groupbox_wrapper">
                                <select id="{concat('KitGroupDropDown_', $group_id)}">
                                </select>
                              </div>
                            </xsl:when>
                            <xsl:otherwise>
                              <div class="kit_item_groupbox_wrapper">
                                <xsl:for-each select="current()/SUB_GROUP_ITEM">
                                  <!--Calls a SUB_GROUP_ITEM template-->
                                  <xsl:apply-templates select="current()" >
                                    <xsl:with-param name="group_id" select="$group_id" />
                                    <xsl:with-param name="group_type" select="$group_type" />
                                  </xsl:apply-templates>
                                </xsl:for-each>
                              </div>
                            </xsl:otherwise>
                          </xsl:choose>
                        </xsl:when>
                        <!--Multi-Select-->
                        <xsl:when test="$group_type = 'Multi-Select'">
                          <div class="kit_item_groupbox_wrapper">
                            <xsl:for-each select="current()/SUB_GROUP_ITEM">

                              <!--Calls a SUB_GROUP_ITEM template-->
                              <xsl:apply-templates select="current()" >
                                <xsl:with-param name="group_id" select="$group_id" />
                                <xsl:with-param name="group_type" select="$group_type" />
                              </xsl:apply-templates>
                              
                            </xsl:for-each>
                          </div>
                        </xsl:when>
                        <!--Optional-->
                        <xsl:otherwise>
                          <xsl:choose>
                            <xsl:when test="current()/CONTROL_TYPE = 'Single select drop down'">
                              <div class="kit_item_groupbox_wrapper">
                                <select id="{concat('KitGroupDropDown_', $group_id)}">
                                </select>
                              </div>
                            </xsl:when>
                            <xsl:otherwise>
                              <div class="kit_item_groupbox_wrapper">
                                <div class="kit_item_none">
                                  <input type="radio" value="0" id="{concat('KitItemRadio_',$group_id, '_None')}" name="{concat('KitGroupRadio_', $group_id)}">
                                    <xsl:if test="current()/NONEOPTIONSHOULDBEDEFAULTSELECTED = 'true'">
                                      <xsl:attribute name="checked">
                                        <xsl:text>true</xsl:text>
                                      </xsl:attribute>
                                    </xsl:if>
                                  </input>
                                  <span class="product_description_min addSpace" id="{concat('lblKitItem_',$group_id,'_0')}">
                                    <xsl:text>None</xsl:text>
                                  </span>
                                </div>
                                <xsl:for-each select="current()/SUB_GROUP_ITEM">
                                  <!--Calls a SUB_GROUP_ITEM template-->
                                  <xsl:apply-templates select="current()">
                                    <xsl:with-param name="group_id" select="$group_id" />
                                    <xsl:with-param name="group_type" select="$group_type" />
                                  </xsl:apply-templates>
                                </xsl:for-each>
                              </div>
                            </xsl:otherwise>
                          </xsl:choose>
                        </xsl:otherwise>
                      </xsl:choose>
                    </div>
                  </div>

                </xsl:for-each>
                
                <xsl:value-of select="FIELD/KIT_SCRIPT" disable-output-escaping="yes" />
                
              </xsl:when>
              
              <xsl:otherwise>
                <div id="kit-details-not-set">
                  <span><xsl:value-of select="FIELD/KIT_NOT_SET_TEXT" />
                  </span>
                </div>
              </xsl:otherwise>
            </xsl:choose>
            
          </xsl:when>

          <!--DISPLAY_PRODUCTENTITYLIST-->
          <xsl:when test="$SectionType='DISPLAY_PRODUCTENTITYLIST'">
            <xsl:for-each select="FIELD/ENTITYXML">
              <a href="{current()/HREF}" class="kitdetaillink">
                <span>
                  <xsl:value-of select="current()/NAME" />
                </span>
              </a>
              <xsl:if test="count(current()/../ENTITYXML)>1 and current()/../ENTITYXML[last()] != current()">
                <xsl:text disable-output-escaping="yes">&amp;nbsp;,&amp;nbsp;</xsl:text>
              </xsl:if>
            </xsl:for-each>
          </xsl:when>

          <xsl:when test="$SectionType='DISPLAY_PRODUCTLINK'">

            <a href="{FIELD/HREF}">
              <span class="product_description">
                <xsl:value-of select="FIELD/TAG_INNER_TEXT"></xsl:value-of>
              </span>
            </a>            
            
          </xsl:when>

          <!-- DISPLAY_SHAREBOX -->
          <xsl:when test="$SectionType='DISPLAY_SHAREBOX'">
            <xsl:if test="ise:AppConfigBool('ShowSocialMediaShareBox') = 'true'">
              <div class="socialmedia_sharebox">

                <xsl:variable name="ProductImage" select="ise:UrlEncode(concat($ProductUrl,'/../',ise:GetProductImageSource('product',$ProductID,'medium')))"/>
                <xsl:variable name="ProductName" select="ise:UrlEncode($ProductName)"/>
                <xsl:variable name="ProductUrl" select="ise:UrlEncode($ProductUrl)"/>
                <xsl:variable name="ProductDesc" select="ise:UrlEncode($ProductDesc)"/>
                <xsl:variable name="HideSubscribeButtons" select="ise:AppConfig('HideSocialMediaShareButton')"/>

                <!--NOT YET SUPPORTED-->
                
                <!--<xsl:if test="contains($HideSubscribeButtons, 'facebook') = false">
                  --><!-- Facebook Share Button --><!--
                  <a class="facebook" target="_blank">
                    <xsl:attribute name="title">Share this product on facebook</xsl:attribute>
                    <xsl:attribute name="href">
                      <xsl:value-of select="concat('http://www.facebook.com/sharer/sharer.php?',
                              's=100',
                              '&amp;p[title]=', $ProductName, 
                              '&amp;p[url]=', $ProductUrl, 
                              '&amp;p[summary]=', $ProductDesc,
                              '&amp;p[images][0]=',$ProductImage)" disable-output-escaping="yes">
                      </xsl:value-of>
                    </xsl:attribute>
                  </a>
                </xsl:if>-->

                <!-- Twitter Share Button -->
                <!--<xsl:if test="contains($HideSubscribeButtons, 'twitter')=true">
                  <a class="twitter" target="_blank">
                    <xsl:attribute name="title">Share this product on twitter</xsl:attribute>
                    <xsl:attribute name="href">
                      <xsl:value-of select="concat('https://twitter.com/share?',
                                                       'text=', $ProductName,
                                                       '&amp;url=', $ProductUrl)"
                                    disable-output-escaping="yes"  />
                    </xsl:attribute>
                    <xsl:attribute name="data-count">none</xsl:attribute>
                  </a>
                </xsl:if>-->

                <!-- Digg Share Button -->
                <!--<xsl:if test="contains($HideSubscribeButtons, 'digg') = false">
                  <a class="digg" target="_blank">
                    <xsl:attribute name="title">Share this product on digg</xsl:attribute>
                    <xsl:attribute name="href">
                      <xsl:value-of select="concat('http://digg.com/submit?',
                                                         'url=', $ProductUrl, 
                                                         '&amp;title=', $ProductName)"
                                                                disable-output-escaping="yes"  />
                    </xsl:attribute>
                  </a>
                </xsl:if>-->

                <!-- StumbleUpon Share Button-->
                <!--<xsl:if test="contains($HideSubscribeButtons, 'stumble') = false">
                  <a class="stumble" target="_blank">
                    <xsl:attribute name="title">Share this product on stumbleupon</xsl:attribute>
                    <xsl:attribute name="href">
                      <xsl:value-of select="concat('http://www.stumbleupon.com/submit?',
                                                       'url=', $ProductUrl)"
                                     disable-output-escaping="yes"  />
                    </xsl:attribute>
                  </a>
                </xsl:if>-->

                <!-- Google Share Button-->
                <!--<xsl:if test="contains($HideSubscribeButtons, 'google') = false">
                  <a class="google" target="_blank">
                    <xsl:attribute name="title">Share this product on google+</xsl:attribute>
                    <xsl:attribute name="href">
                      <xsl:value-of select="concat('https://plus.google.com/share?',
                                                       'url=', $ProductUrl)"
                                   disable-output-escaping="yes"  />
                    </xsl:attribute>
                  </a>
                </xsl:if>-->

                <!-- Email Share Button -->
                <xsl:if test="contains($HideSubscribeButtons, 'email') = false">
                  <a class="email">
                    <xsl:attribute name="title">Email this product to friend</xsl:attribute>
                    <xsl:attribute name="href">
                      emailproduct.aspx?productId=<xsl:value-of select="$ProductID" disable-output-escaping="yes" />&amp;categoryid=<xsl:value-of select="$CategoryID" disable-output-escaping="yes" />
                    </xsl:attribute>
                  </a>
                </xsl:if>

              </div>
            </xsl:if>
          </xsl:when>

          <xsl:otherwise>
            <xsl:value-of select="FIELD/SECTION_TYPE" />
          </xsl:otherwise>

        </xsl:choose>

      </xsl:template>

      <xsl:template match="SUBSTITUTE_ITEMS">
        <div class="showproduct_photo">
          <a href="{current()/IMAGE/ITEM_LINK}">
            <img class="mobileimagesize" src="{current()/IMAGE/IMG_URL}" alt="{current()/IMAGE/IMG_ALT_TEXT}" title="{current()/IMAGE/IMG_TITLE_TEXT}" />
          </a>
        </div>
      </xsl:template>

      <xsl:template match="JSON_SWATCHITEM">
        <div class="showproduct_photo addSpace">
          <img class="mobilesswatch_imagesize" id="{concat('imgSwatch_', current()/COUNTER, concat('_',current()/ITEM_COUNTER))}" alt="{current()/IMG_ALT_TEXT}" title="{current()/IMG_TITLE_TEXT}" />
        </div>
      </xsl:template>

      <xsl:template match="SUB_GROUP_ITEM">
        <xsl:param name="group_id" />
        <xsl:param name="group_type" />
        <xsl:param name="stringActualInventory" select="ise:StringResource('showproduct.aspx.47')" />
        <div class="kit_item_groupbox" >
          
          <xsl:choose>
            <xsl:when test="$group_type = 'Multi-Select'">
              <input type="checkbox" id="{concat('KitItemCheckBox_',$group_id,'_',current()/SUB_GROUP_ITEM_ID)}" name="{concat('KitItemCheckBox_',$group_id,'_',current()/SUB_GROUP_ITEM_ID)}" value="{current()/SUB_GROUP_ITEM_ID}" >
                <xsl:if test="current()/IS_SELECTED = 'true'">
                  <xsl:attribute name="checked">true</xsl:attribute>
                </xsl:if>
              </input>
            </xsl:when>
            <xsl:otherwise>
              <input type="radio" id="{concat('KitItemRadio_',$group_id,'_', current()/SUB_GROUP_ITEM_ID)}" name="{concat('KitGroupRadio_',$group_id)}" value="{current()/SUB_GROUP_ITEM_ID}">
                <xsl:if test="current()/IS_SELECTED = 'true'">
                  <xsl:attribute name="checked">true</xsl:attribute>
                </xsl:if>
              </input>
            </xsl:otherwise>
          </xsl:choose>
          
          <span class="product_description_min addSpace" id="{concat('lblKitItem_', $group_id, '_', current()/SUB_GROUP_ITEM_ID)}">
            <xsl:value-of select="current()/NAME" />
          </span>
          
          <br />
          <table class="price_stockhints_wrapper">
            <tr>
              <td class="kit_stock_hints_price">
                <span class="showproduct_Price_min" id="{concat('PriceDelta_',$group_id,'_',current()/SUB_GROUP_ITEM_ID)}">
                </span>
              </td>
              <xsl:choose>
               <xsl:when test="current()/SHOW_STOCKHINTS = 'true'">
                <td class="kit_stock_hints">
                  <xsl:choose>
                    <xsl:when test="current()/HAS_STOCK = 'true'">
                      <img alt="" title="" src="{concat('skins/skin_',current()/SKINID, '/images/instock.png')}" />
                    </xsl:when>
                    <xsl:otherwise>
                      <img alt="" title="" src="{concat('skins/skin_',current()/SKINID, '/images/outofstock.png')}" />
                    </xsl:otherwise>
                  </xsl:choose>
                  <br />
                </td>
              </xsl:when>
              <xsl:when test="current()/SHOW_ACTUAL_INVENTORY = 'true'">
                    <td class="kit_stock_count">
                        <xsl:choose>
                            <xsl:when test="current()/HAS_STOCK = 'true'">
                                <xsl:value-of select="concat(current()/STOCK_COUNT, ' ', $stringActualInventory)"/>
                            </xsl:when>
                            <xsl:otherwise>
                                <img alt="" title="" src="{concat('skins/skin_',current()/SKINID, '/images/outofstock.png')}" />
                            </xsl:otherwise>
                        </xsl:choose>
                        <br />
                    </td>
               </xsl:when>
             </xsl:choose>   
            </tr>
          </table>
        </div>
      </xsl:template>

    </xsl:stylesheet>
  </PackageTransform>
</package>